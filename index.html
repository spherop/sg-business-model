<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sonic Grid Revenue Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0a0a0f;
            --bg-card: #12121a;
            --bg-input: #1a1a24;
            --accent-cyan: #00f5d4;
            --accent-magenta: #f72585;
            --accent-yellow: #fee440;
            --accent-purple: #7b2cbf;
            --text-primary: #ffffff;
            --text-secondary: #8b8b9e;
            --text-muted: #4a4a5c;
            --border: #2a2a3a;
            --gradient-1: linear-gradient(135deg, #00f5d4 0%, #7b2cbf 100%);
            --gradient-2: linear-gradient(135deg, #f72585 0%, #fee440 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Syne', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .noise-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
            z-index: 1000;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 24px;
        }

        header {
            text-align: center;
            margin-bottom: 48px;
            position: relative;
        }

        .logo {
            font-family: 'Space Mono', monospace;
            font-size: 14px;
            letter-spacing: 4px;
            color: var(--accent-cyan);
            text-transform: uppercase;
            margin-bottom: 16px;
        }

        h1 {
            font-size: clamp(2.5rem, 6vw, 4.5rem);
            font-weight: 800;
            line-height: 1.1;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 16px;
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin: 0 auto;
        }

        /* Growth Settings Panel */
        .growth-panel {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 32px;
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .panel-title {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .curve-selector {
            display: flex;
            gap: 8px;
        }

        .curve-btn {
            padding: 10px 20px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .curve-btn:hover {
            border-color: var(--text-secondary);
        }

        .curve-btn.active {
            background: var(--accent-cyan);
            border-color: var(--accent-cyan);
            color: var(--bg-dark);
        }

        .growth-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
        }

        .year-card {
            background: var(--bg-input);
            border-radius: 16px;
            padding: 24px;
            position: relative;
        }

        .year-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            border-radius: 16px 16px 0 0;
        }

        .year-card.year-1::before { background: var(--accent-cyan); }
        .year-card.year-2::before { background: var(--accent-magenta); }
        .year-card.year-3::before { background: var(--accent-yellow); }

        .year-label {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 16px;
        }

        .year-card.year-1 .year-label { color: var(--accent-cyan); }
        .year-card.year-2 .year-label { color: var(--accent-magenta); }
        .year-card.year-3 .year-label { color: var(--accent-yellow); }

        .year-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .input-group label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-family: 'Space Mono', monospace;
        }

        .input-group input, .input-group select {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px 14px;
            color: var(--text-primary);
            font-family: 'Space Mono', monospace;
            font-size: 14px;
            transition: all 0.2s ease;
            width: 100%;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: var(--accent-cyan);
            box-shadow: 0 0 0 3px rgba(0, 245, 212, 0.1);
        }

        /* Chart Container */
        .chart-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 32px;
            margin-bottom: 32px;
        }

        .chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .chart-title {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .chart-legend {
            display: flex;
            gap: 24px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .legend-dot.artists { background: var(--accent-cyan); }
        .legend-dot.listeners { background: var(--accent-magenta); }
        .legend-dot.revenue { background: var(--accent-yellow); }

        .chart-area {
            height: 300px;
            position: relative;
            margin-bottom: 16px;
        }

        canvas {
            width: 100% !important;
            height: 100% !important;
        }

        /* Dashboard Layout */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 32px;
            align-items: start;
        }

        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }

        .revenue-streams {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .stream-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stream-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-1);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stream-card:hover::before,
        .stream-card.active::before {
            opacity: 1;
        }

        .stream-card.active {
            border-color: var(--accent-cyan);
            box-shadow: 0 0 40px rgba(0, 245, 212, 0.1);
        }

        .stream-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .stream-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .stream-toggle {
            width: 52px;
            height: 28px;
            background: var(--bg-input);
            border-radius: 14px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s ease;
            border: 1px solid var(--border);
        }

        .stream-toggle.active {
            background: var(--accent-cyan);
            border-color: var(--accent-cyan);
        }

        .stream-toggle::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: var(--text-primary);
            border-radius: 50%;
            top: 2px;
            left: 3px;
            transition: transform 0.3s ease;
        }

        .stream-toggle.active::after {
            transform: translateX(24px);
        }

        .stream-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .stream-phase {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 20px;
            background: var(--bg-input);
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stream-phase.mvp { background: rgba(0, 245, 212, 0.15); color: var(--accent-cyan); }
        .stream-phase.phase2 { background: rgba(247, 37, 133, 0.15); color: var(--accent-magenta); }
        .stream-phase.phase3 { background: rgba(254, 228, 64, 0.15); color: var(--accent-yellow); }

        .stream-revenues {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .stream-revenue-item {
            text-align: right;
        }

        .stream-revenue-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stream-revenue {
            font-family: 'Space Mono', monospace;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .stream-revenue.y1 { color: var(--accent-cyan); }
        .stream-revenue.y2 { color: var(--accent-magenta); }
        .stream-revenue.y3 { color: var(--accent-yellow); }

        .stream-inputs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 16px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        /* Summary Panel */
        .summary-panel {
            position: sticky;
            top: 24px;
        }

        .summary-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 32px;
            position: relative;
            overflow: hidden;
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0, 245, 212, 0.05) 0%, transparent 50%);
            pointer-events: none;
        }

        .summary-title {
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            letter-spacing: 2px;
            color: var(--text-secondary);
            text-transform: uppercase;
            margin-bottom: 24px;
        }

        .year-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
        }

        .year-tab {
            flex: 1;
            padding: 12px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .year-tab:hover {
            border-color: var(--text-secondary);
        }

        .year-tab.active {
            border-color: var(--accent-cyan);
            color: var(--accent-cyan);
        }

        .total-revenue {
            margin-bottom: 32px;
        }

        .total-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .total-amount {
            font-family: 'Space Mono', monospace;
            font-size: 2.5rem;
            font-weight: 700;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
        }

        .total-period {
            font-family: 'Space Mono', monospace;
            font-size: 14px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 24px;
        }

        .metric-box {
            background: var(--bg-input);
            border-radius: 12px;
            padding: 14px;
        }

        .metric-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .metric-value {
            font-family: 'Space Mono', monospace;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .metric-value.positive { color: var(--accent-cyan); }
        .metric-value.highlight { color: var(--accent-magenta); }

        .three-year-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 24px;
            padding: 16px;
            background: var(--bg-input);
            border-radius: 12px;
        }

        .three-year-item {
            text-align: center;
        }

        .three-year-label {
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-bottom: 4px;
        }

        .three-year-value {
            font-family: 'Space Mono', monospace;
            font-size: 1rem;
            font-weight: 600;
        }

        .three-year-item:nth-child(1) .three-year-value { color: var(--accent-cyan); }
        .three-year-item:nth-child(2) .three-year-value { color: var(--accent-magenta); }
        .three-year-item:nth-child(3) .three-year-value { color: var(--accent-yellow); }

        .breakdown-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .breakdown-item:last-child {
            border-bottom: none;
        }

        .breakdown-name {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .breakdown-amount {
            font-family: 'Space Mono', monospace;
            font-size: 13px;
            color: var(--text-primary);
        }

        /* Add Stream Button */
        .add-stream-btn {
            width: 100%;
            padding: 20px;
            background: var(--bg-card);
            border: 2px dashed var(--border);
            border-radius: 16px;
            color: var(--text-secondary);
            font-family: 'Syne', sans-serif;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .add-stream-btn:hover {
            border-color: var(--accent-cyan);
            color: var(--accent-cyan);
            background: rgba(0, 245, 212, 0.05);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 15, 0.9);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            padding: 24px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 500px;
            position: relative;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 24px;
        }

        .modal-inputs {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 32px;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
        }

        .btn {
            flex: 1;
            padding: 14px 24px;
            border-radius: 10px;
            font-family: 'Syne', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .btn-primary {
            background: var(--accent-cyan);
            color: var(--bg-dark);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 245, 212, 0.3);
        }

        .btn-secondary {
            background: var(--bg-input);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--text-secondary);
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 36px;
            height: 36px;
            background: var(--bg-input);
            border: none;
            border-radius: 50%;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.2s ease;
        }

        .close-modal:hover {
            background: var(--border);
            color: var(--text-primary);
        }

        /* Monthly Table */
        .monthly-table-container {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 32px;
            margin-top: 32px;
            overflow-x: auto;
        }

        .monthly-table {
            width: 100%;
            border-collapse: collapse;
            font-family: 'Space Mono', monospace;
            font-size: 12px;
        }

        .monthly-table th {
            text-align: left;
            padding: 12px 16px;
            border-bottom: 2px solid var(--border);
            color: var(--text-secondary);
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .monthly-table td {
            padding: 10px 16px;
            border-bottom: 1px solid var(--border);
            color: var(--text-primary);
        }

        .monthly-table tr:hover td {
            background: var(--bg-input);
        }

        .monthly-table .year-row {
            background: var(--bg-input);
        }

        .monthly-table .year-row td {
            font-weight: 700;
            border-bottom: 2px solid var(--border);
        }

        .table-toggle {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
        }

        .table-toggle label {
            font-size: 14px;
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div class="noise-overlay"></div>
    
    <div class="container">
        <header>
            <div class="logo">Sonic Grid</div>
            <h1>Revenue Calculator</h1>
            <p class="subtitle">Model growth curves and revenue projections across 3 years with realistic user ramps.</p>
        </header>

        <!-- Growth Settings Panel -->
        <div class="growth-panel">
            <div class="panel-header">
                <h2 class="panel-title">Growth Projections</h2>
                <div class="curve-selector">
                    <button class="curve-btn active" data-curve="linear">Linear</button>
                    <button class="curve-btn" data-curve="scurve">S-Curve</button>
                    <button class="curve-btn" data-curve="exponential">Exponential</button>
                </div>
            </div>
            <div class="growth-grid">
                <div class="year-card year-1">
                    <div class="year-label">Year 1</div>
                    <div class="year-inputs">
                        <div class="input-group">
                            <label>Starting Artists</label>
                            <input type="number" id="y1StartArtists" value="0">
                        </div>
                        <div class="input-group">
                            <label>Ending Artists</label>
                            <input type="number" id="y1EndArtists" value="20000">
                        </div>
                        <div class="input-group">
                            <label>Starting Listeners</label>
                            <input type="number" id="y1StartListeners" value="0">
                        </div>
                        <div class="input-group">
                            <label>Ending Listeners</label>
                            <input type="number" id="y1EndListeners" value="200000">
                        </div>
                    </div>
                </div>
                <div class="year-card year-2">
                    <div class="year-label">Year 2</div>
                    <div class="year-inputs">
                        <div class="input-group">
                            <label>Starting Artists</label>
                            <input type="number" id="y2StartArtists" value="20000" readonly style="opacity: 0.6;">
                        </div>
                        <div class="input-group">
                            <label>Ending Artists</label>
                            <input type="number" id="y2EndArtists" value="100000">
                        </div>
                        <div class="input-group">
                            <label>Starting Listeners</label>
                            <input type="number" id="y2StartListeners" value="200000" readonly style="opacity: 0.6;">
                        </div>
                        <div class="input-group">
                            <label>Ending Listeners</label>
                            <input type="number" id="y2EndListeners" value="1500000">
                        </div>
                    </div>
                </div>
                <div class="year-card year-3">
                    <div class="year-label">Year 3</div>
                    <div class="year-inputs">
                        <div class="input-group">
                            <label>Starting Artists</label>
                            <input type="number" id="y3StartArtists" value="100000" readonly style="opacity: 0.6;">
                        </div>
                        <div class="input-group">
                            <label>Ending Artists</label>
                            <input type="number" id="y3EndArtists" value="300000">
                        </div>
                        <div class="input-group">
                            <label>Starting Listeners</label>
                            <input type="number" id="y3StartListeners" value="1500000" readonly style="opacity: 0.6;">
                        </div>
                        <div class="input-group">
                            <label>Ending Listeners</label>
                            <input type="number" id="y3EndListeners" value="6000000">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chart -->
        <div class="chart-container">
            <div class="chart-header">
                <h2 class="chart-title">Growth & Revenue Trajectory</h2>
                <div class="chart-legend">
                    <div class="legend-item">
                        <div class="legend-dot artists"></div>
                        <span>Artists</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot listeners"></div>
                        <span>Listeners</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-dot revenue"></div>
                        <span>Monthly Revenue</span>
                    </div>
                </div>
            </div>
            <div class="chart-area">
                <canvas id="growthChart"></canvas>
            </div>
        </div>

        <!-- Dashboard -->
        <div class="dashboard">
            <div class="revenue-streams" id="streamsList">
                <!-- Revenue streams will be rendered here -->
            </div>

            <div class="summary-panel">
                <div class="summary-card">
                    <div class="summary-title">Revenue Summary</div>
                    
                    <div class="year-tabs">
                        <button class="year-tab active" data-year="1">Year 1</button>
                        <button class="year-tab" data-year="2">Year 2</button>
                        <button class="year-tab" data-year="3">Year 3</button>
                    </div>

                    <div class="total-revenue">
                        <div class="total-label">Annual Revenue</div>
                        <div class="total-amount" id="totalRevenue">$0</div>
                        <div class="total-period" id="revenuePeriod">Year 1</div>
                    </div>

                    <div class="three-year-summary">
                        <div class="three-year-item">
                            <div class="three-year-label">Y1 Total</div>
                            <div class="three-year-value" id="y1Total">$0</div>
                        </div>
                        <div class="three-year-item">
                            <div class="three-year-label">Y2 Total</div>
                            <div class="three-year-value" id="y2Total">$0</div>
                        </div>
                        <div class="three-year-item">
                            <div class="three-year-label">Y3 Total</div>
                            <div class="three-year-value" id="y3Total">$0</div>
                        </div>
                    </div>

                    <div class="metrics-grid">
                        <div class="metric-box">
                            <div class="metric-label">Monthly (Avg)</div>
                            <div class="metric-value positive" id="monthlyRevenue">$0</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">Active Streams</div>
                            <div class="metric-value highlight" id="activeStreams">0</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">Per Artist (EOY)</div>
                            <div class="metric-value" id="revenuePerArtist">$0</div>
                        </div>
                        <div class="metric-box">
                            <div class="metric-label">Per Listener (EOY)</div>
                            <div class="metric-value" id="revenuePerListener">$0</div>
                        </div>
                    </div>

                    <div class="breakdown-list" id="revenueBreakdown">
                        <!-- Breakdown will be rendered here -->
                    </div>
                </div>
            </div>
        </div>

        <button class="add-stream-btn" onclick="openModal()">
            <span>+</span> Add Custom Revenue Stream
        </button>

        <!-- Monthly Breakdown Table -->
        <div class="monthly-table-container">
            <div class="table-toggle">
                <h2 class="chart-title">Month-by-Month Projections</h2>
            </div>
            <table class="monthly-table">
                <thead>
                    <tr>
                        <th>Month</th>
                        <th>Artists</th>
                        <th>Listeners</th>
                        <th>Monthly Rev</th>
                        <th>Cumulative Rev</th>
                    </tr>
                </thead>
                <tbody id="monthlyTableBody">
                    <!-- Table rows will be rendered here -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <button class="close-modal" onclick="closeModal()">Ã—</button>
            <h2 class="modal-title">Add Revenue Stream</h2>
            <div class="modal-inputs">
                <div class="input-group">
                    <label>Stream Name</label>
                    <input type="text" id="newStreamName" placeholder="e.g., Premium Subscriptions">
                </div>
                <div class="input-group">
                    <label>Revenue Type</label>
                    <select id="newStreamType">
                        <option value="recurring">Recurring (per month)</option>
                        <option value="transaction">Transaction-based</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Phase</label>
                    <select id="newStreamPhase">
                        <option value="MVP">MVP</option>
                        <option value="Phase 2">Phase 2</option>
                        <option value="Phase 3">Phase 3</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Price Point ($)</label>
                    <input type="number" id="newStreamPrice" placeholder="9.99">
                </div>
                <div class="input-group">
                    <label>Adoption Rate (%)</label>
                    <input type="number" id="newStreamAdoption" placeholder="10" max="100">
                </div>
                <div class="input-group">
                    <label>Applies To</label>
                    <select id="newStreamTarget">
                        <option value="artists">Artists</option>
                        <option value="listeners">Listeners</option>
                        <option value="both">Both</option>
                    </select>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="addStream()">Add Stream</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        // State
        let selectedYear = 1;
        let growthCurve = 'linear';
        let chart = null;

        // Revenue streams
        let revenueStreams = [
            {
                id: 1,
                name: "Listener Subscription",
                phase: "MVP",
                type: "recurring",
                active: true,
                price: 9.99,
                adoption: 5,
                target: "listeners",
                platformTake: 100
            },
            {
                id: 2,
                name: "Artist Subscription",
                phase: "MVP",
                type: "recurring",
                active: true,
                price: 25,
                adoption: 15,
                target: "artists",
                platformTake: 100
            },
            {
                id: 3,
                name: "Fan-to-Artist Paywall",
                phase: "MVP",
                type: "transaction",
                active: true,
                price: 8,
                adoption: 3,
                target: "listeners",
                platformTake: 15,
                frequency: 12
            },
            {
                id: 4,
                name: "Token-Based Access",
                phase: "Phase 2",
                type: "hybrid",
                active: false,
                price: 5,
                adoption: 8,
                target: "listeners",
                platformTake: 100,
                frequency: 6
            },
            {
                id: 5,
                name: "Podcast Subscriptions",
                phase: "Phase 2",
                type: "recurring",
                active: false,
                price: 7.99,
                adoption: 2,
                target: "listeners",
                platformTake: 100
            },
            {
                id: 6,
                name: "Advertising/Sponsorship",
                phase: "Phase 3",
                type: "transaction",
                active: false,
                price: 0.01,
                adoption: 80,
                target: "listeners",
                platformTake: 100,
                frequency: 52
            },
            {
                id: 7,
                name: "Merchandise Platform",
                phase: "Phase 2",
                type: "transaction",
                active: false,
                price: 35,
                adoption: 2,
                target: "listeners",
                platformTake: 12,
                frequency: 2
            },
            {
                id: 8,
                name: "Custom Features",
                phase: "Phase 2",
                type: "transaction",
                active: false,
                price: 50,
                adoption: 10,
                target: "artists",
                platformTake: 100,
                frequency: 1
            },
            {
                id: 9,
                name: "Per-Track Sales",
                phase: "Phase 2",
                type: "transaction",
                active: false,
                price: 1.29,
                adoption: 5,
                target: "listeners",
                platformTake: 30,
                frequency: 4
            },
            {
                id: 10,
                name: "App Store Commission",
                phase: "Phase 2",
                type: "transaction",
                active: false,
                price: 15,
                adoption: 5,
                target: "artists",
                platformTake: 30,
                frequency: 12
            },
            {
                id: 11,
                name: "Design Templates",
                phase: "Phase 2",
                type: "transaction",
                active: false,
                price: 25,
                adoption: 20,
                target: "artists",
                platformTake: 100,
                frequency: 2
            },
            {
                id: 12,
                name: "Label Tier",
                phase: "Phase 3",
                type: "recurring",
                active: false,
                price: 199,
                adoption: 2,
                target: "artists",
                platformTake: 100
            },
            {
                id: 13,
                name: "Gig Marketplace",
                phase: "Phase 3",
                type: "transaction",
                active: false,
                price: 500,
                adoption: 5,
                target: "artists",
                platformTake: 10,
                frequency: 4
            },
            {
                id: 14,
                name: "Events & Ticketing",
                phase: "Phase 3",
                type: "transaction",
                active: false,
                price: 40,
                adoption: 1,
                target: "listeners",
                platformTake: 8,
                frequency: 2
            },
            {
                id: 15,
                name: "Gear Marketplace",
                phase: "Phase 2",
                type: "transaction",
                active: false,
                price: 250,
                adoption: 8,
                target: "artists",
                platformTake: 10,
                frequency: 2
            }
        ];

        let nextId = 16;

        // Growth curve functions
        function getGrowthValue(start, end, month, totalMonths, curve) {
            const t = month / totalMonths;
            
            switch(curve) {
                case 'linear':
                    return start + (end - start) * t;
                case 'scurve':
                    // S-curve using smoothstep
                    const s = t * t * (3 - 2 * t);
                    return start + (end - start) * s;
                case 'exponential':
                    // Exponential growth
                    if (start === 0) start = 1;
                    const ratio = end / start;
                    return start * Math.pow(ratio, t);
                default:
                    return start + (end - start) * t;
            }
        }

        function getMonthlyData() {
            const data = [];
            
            // Year 1
            const y1StartA = parseInt(document.getElementById('y1StartArtists').value) || 0;
            const y1EndA = parseInt(document.getElementById('y1EndArtists').value) || 0;
            const y1StartL = parseInt(document.getElementById('y1StartListeners').value) || 0;
            const y1EndL = parseInt(document.getElementById('y1EndListeners').value) || 0;
            
            // Year 2
            const y2EndA = parseInt(document.getElementById('y2EndArtists').value) || 0;
            const y2EndL = parseInt(document.getElementById('y2EndListeners').value) || 0;
            
            // Year 3
            const y3EndA = parseInt(document.getElementById('y3EndArtists').value) || 0;
            const y3EndL = parseInt(document.getElementById('y3EndListeners').value) || 0;

            // Generate 36 months of data
            for (let m = 1; m <= 36; m++) {
                let artists, listeners, year;
                
                if (m <= 12) {
                    year = 1;
                    artists = getGrowthValue(y1StartA, y1EndA, m, 12, growthCurve);
                    listeners = getGrowthValue(y1StartL, y1EndL, m, 12, growthCurve);
                } else if (m <= 24) {
                    year = 2;
                    artists = getGrowthValue(y1EndA, y2EndA, m - 12, 12, growthCurve);
                    listeners = getGrowthValue(y1EndL, y2EndL, m - 12, 12, growthCurve);
                } else {
                    year = 3;
                    artists = getGrowthValue(y2EndA, y3EndA, m - 24, 12, growthCurve);
                    listeners = getGrowthValue(y2EndL, y3EndL, m - 24, 12, growthCurve);
                }

                // Calculate monthly revenue for this month
                let monthlyRev = 0;
                revenueStreams.forEach(stream => {
                    if (!stream.active) return;
                    
                    let baseUsers = stream.target === 'artists' ? artists : 
                                    stream.target === 'listeners' ? listeners : 
                                    artists + listeners;
                    
                    const adoptingUsers = baseUsers * (stream.adoption / 100);
                    const platformRevenue = stream.price * (stream.platformTake / 100);
                    
                    if (stream.type === 'recurring') {
                        monthlyRev += adoptingUsers * platformRevenue;
                    } else {
                        const monthlyFreq = (stream.frequency || 12) / 12;
                        monthlyRev += adoptingUsers * platformRevenue * monthlyFreq;
                    }
                });

                data.push({
                    month: m,
                    year,
                    label: `Y${year} M${m <= 12 ? m : m <= 24 ? m - 12 : m - 24}`,
                    artists: Math.round(artists),
                    listeners: Math.round(listeners),
                    monthlyRevenue: monthlyRev
                });
            }

            return data;
        }

        function formatCurrency(amount) {
            if (amount >= 1000000000) {
                return '$' + (amount / 1000000000).toFixed(2) + 'B';
            } else if (amount >= 1000000) {
                return '$' + (amount / 1000000).toFixed(2) + 'M';
            } else if (amount >= 1000) {
                return '$' + (amount / 1000).toFixed(1) + 'K';
            }
            return '$' + Math.round(amount).toLocaleString();
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(0) + 'K';
            }
            return num.toLocaleString();
        }

        function calculateYearlyRevenue(yearNum) {
            const monthlyData = getMonthlyData();
            const yearData = monthlyData.filter(d => d.year === yearNum);
            return yearData.reduce((sum, d) => sum + d.monthlyRevenue, 0);
        }

        function renderChart() {
            const ctx = document.getElementById('growthChart').getContext('2d');
            const monthlyData = getMonthlyData();

            const labels = monthlyData.map(d => d.label);
            const artistsData = monthlyData.map(d => d.artists);
            const listenersData = monthlyData.map(d => d.listeners);
            const revenueData = monthlyData.map(d => d.monthlyRevenue);

            if (chart) {
                chart.destroy();
            }

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [
                        {
                            label: 'Artists',
                            data: artistsData,
                            borderColor: '#00f5d4',
                            backgroundColor: 'rgba(0, 245, 212, 0.1)',
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Listeners',
                            data: listenersData,
                            borderColor: '#f72585',
                            backgroundColor: 'rgba(247, 37, 133, 0.1)',
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Monthly Revenue',
                            data: revenueData,
                            borderColor: '#fee440',
                            backgroundColor: 'rgba(254, 228, 64, 0.1)',
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: '#12121a',
                            borderColor: '#2a2a3a',
                            borderWidth: 1,
                            titleFont: { family: 'Space Mono' },
                            bodyFont: { family: 'Space Mono' },
                            callbacks: {
                                label: function(context) {
                                    if (context.dataset.label === 'Monthly Revenue') {
                                        return context.dataset.label + ': ' + formatCurrency(context.raw);
                                    }
                                    return context.dataset.label + ': ' + formatNumber(context.raw);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(42, 42, 58, 0.5)' },
                            ticks: { 
                                color: '#8b8b9e',
                                font: { family: 'Space Mono', size: 10 },
                                maxRotation: 45
                            }
                        },
                        y: {
                            type: 'linear',
                            position: 'left',
                            grid: { color: 'rgba(42, 42, 58, 0.5)' },
                            ticks: { 
                                color: '#8b8b9e',
                                font: { family: 'Space Mono', size: 10 },
                                callback: (v) => formatNumber(v)
                            }
                        },
                        y1: {
                            type: 'linear',
                            position: 'right',
                            grid: { drawOnChartArea: false },
                            ticks: { 
                                color: '#fee440',
                                font: { family: 'Space Mono', size: 10 },
                                callback: (v) => formatCurrency(v)
                            }
                        }
                    }
                }
            });
        }

        function renderStreams() {
            const container = document.getElementById('streamsList');
            container.innerHTML = '';

            const y1Rev = {}, y2Rev = {}, y3Rev = {};
            const monthlyData = getMonthlyData();

            // Calculate per-stream revenue by year
            revenueStreams.forEach(stream => {
                y1Rev[stream.id] = 0;
                y2Rev[stream.id] = 0;
                y3Rev[stream.id] = 0;

                if (!stream.active) return;

                monthlyData.forEach(d => {
                    let baseUsers = stream.target === 'artists' ? d.artists : 
                                    stream.target === 'listeners' ? d.listeners : 
                                    d.artists + d.listeners;
                    
                    const adoptingUsers = baseUsers * (stream.adoption / 100);
                    const platformRevenue = stream.price * (stream.platformTake / 100);
                    
                    let monthlyRev;
                    if (stream.type === 'recurring') {
                        monthlyRev = adoptingUsers * platformRevenue;
                    } else {
                        const monthlyFreq = (stream.frequency || 12) / 12;
                        monthlyRev = adoptingUsers * platformRevenue * monthlyFreq;
                    }

                    if (d.year === 1) y1Rev[stream.id] += monthlyRev;
                    else if (d.year === 2) y2Rev[stream.id] += monthlyRev;
                    else y3Rev[stream.id] += monthlyRev;
                });
            });

            revenueStreams.forEach(stream => {
                const phaseClass = stream.phase === 'MVP' ? 'mvp' : 
                                   stream.phase === 'Phase 2' ? 'phase2' : 'phase3';
                
                const html = `
                    <div class="stream-card ${stream.active ? 'active' : ''}" data-id="${stream.id}">
                        <div class="stream-header">
                            <div class="stream-info">
                                <div class="stream-toggle ${stream.active ? 'active' : ''}" 
                                     onclick="toggleStream(${stream.id})"></div>
                                <div>
                                    <div class="stream-name">${stream.name}</div>
                                    <span class="stream-phase ${phaseClass}">${stream.phase}</span>
                                </div>
                            </div>
                            <div class="stream-revenues">
                                <div class="stream-revenue-item">
                                    <div class="stream-revenue-label">Y1</div>
                                    <div class="stream-revenue y1">${formatCurrency(y1Rev[stream.id])}</div>
                                </div>
                                <div class="stream-revenue-item">
                                    <div class="stream-revenue-label">Y2</div>
                                    <div class="stream-revenue y2">${formatCurrency(y2Rev[stream.id])}</div>
                                </div>
                                <div class="stream-revenue-item">
                                    <div class="stream-revenue-label">Y3</div>
                                    <div class="stream-revenue y3">${formatCurrency(y3Rev[stream.id])}</div>
                                </div>
                            </div>
                        </div>
                        <div class="stream-inputs">
                            <div class="input-group">
                                <label>Price ($)</label>
                                <input type="number" value="${stream.price}" step="0.01"
                                       onchange="updateStream(${stream.id}, 'price', this.value)">
                            </div>
                            <div class="input-group">
                                <label>Adoption (%)</label>
                                <input type="number" value="${stream.adoption}" max="100"
                                       onchange="updateStream(${stream.id}, 'adoption', this.value)">
                            </div>
                            <div class="input-group">
                                <label>Platform %</label>
                                <input type="number" value="${stream.platformTake}" max="100"
                                       onchange="updateStream(${stream.id}, 'platformTake', this.value)">
                            </div>
                            ${stream.type !== 'recurring' ? `
                            <div class="input-group">
                                <label>Freq/yr</label>
                                <input type="number" value="${stream.frequency || 12}"
                                       onchange="updateStream(${stream.id}, 'frequency', this.value)">
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                container.innerHTML += html;
            });

            updateSummary();
            renderMonthlyTable();
        }

        function toggleStream(id) {
            const stream = revenueStreams.find(s => s.id === id);
            if (stream) {
                stream.active = !stream.active;
                renderStreams();
                renderChart();
            }
        }

        function updateStream(id, field, value) {
            const stream = revenueStreams.find(s => s.id === id);
            if (stream) {
                stream[field] = parseFloat(value) || 0;
                renderStreams();
                renderChart();
            }
        }

        function updateSummary() {
            const y1Total = calculateYearlyRevenue(1);
            const y2Total = calculateYearlyRevenue(2);
            const y3Total = calculateYearlyRevenue(3);

            document.getElementById('y1Total').textContent = formatCurrency(y1Total);
            document.getElementById('y2Total').textContent = formatCurrency(y2Total);
            document.getElementById('y3Total').textContent = formatCurrency(y3Total);

            const yearTotals = { 1: y1Total, 2: y2Total, 3: y3Total };
            const currentYearTotal = yearTotals[selectedYear];

            document.getElementById('totalRevenue').textContent = formatCurrency(currentYearTotal);
            document.getElementById('revenuePeriod').textContent = `Year ${selectedYear}`;
            document.getElementById('monthlyRevenue').textContent = formatCurrency(currentYearTotal / 12);

            // Get end of year counts for selected year
            let endArtists, endListeners;
            if (selectedYear === 1) {
                endArtists = parseInt(document.getElementById('y1EndArtists').value) || 0;
                endListeners = parseInt(document.getElementById('y1EndListeners').value) || 0;
            } else if (selectedYear === 2) {
                endArtists = parseInt(document.getElementById('y2EndArtists').value) || 0;
                endListeners = parseInt(document.getElementById('y2EndListeners').value) || 0;
            } else {
                endArtists = parseInt(document.getElementById('y3EndArtists').value) || 0;
                endListeners = parseInt(document.getElementById('y3EndListeners').value) || 0;
            }

            document.getElementById('revenuePerArtist').textContent = endArtists > 0 ? 
                formatCurrency(currentYearTotal / endArtists) : '$0';
            document.getElementById('revenuePerListener').textContent = endListeners > 0 ? 
                formatCurrency(currentYearTotal / endListeners) : '$0';

            // Active streams
            document.getElementById('activeStreams').textContent = 
                revenueStreams.filter(s => s.active).length;

            // Breakdown for selected year
            const breakdown = [];
            const monthlyData = getMonthlyData();
            
            revenueStreams.forEach(stream => {
                if (!stream.active) return;
                
                let yearRev = 0;
                monthlyData.filter(d => d.year === selectedYear).forEach(d => {
                    let baseUsers = stream.target === 'artists' ? d.artists : 
                                    stream.target === 'listeners' ? d.listeners : 
                                    d.artists + d.listeners;
                    
                    const adoptingUsers = baseUsers * (stream.adoption / 100);
                    const platformRevenue = stream.price * (stream.platformTake / 100);
                    
                    if (stream.type === 'recurring') {
                        yearRev += adoptingUsers * platformRevenue;
                    } else {
                        const monthlyFreq = (stream.frequency || 12) / 12;
                        yearRev += adoptingUsers * platformRevenue * monthlyFreq;
                    }
                });

                if (yearRev > 0) {
                    breakdown.push({ name: stream.name, amount: yearRev });
                }
            });

            breakdown.sort((a, b) => b.amount - a.amount);

            const breakdownHtml = breakdown.slice(0, 6).map(item => `
                <div class="breakdown-item">
                    <span class="breakdown-name">${item.name}</span>
                    <span class="breakdown-amount">${formatCurrency(item.amount)}</span>
                </div>
            `).join('');
            document.getElementById('revenueBreakdown').innerHTML = breakdownHtml;
        }

        function renderMonthlyTable() {
            const monthlyData = getMonthlyData();
            let cumulative = 0;
            let html = '';

            monthlyData.forEach((d, i) => {
                cumulative += d.monthlyRevenue;
                
                // Add year header row
                if (d.month === 1 || d.month === 13 || d.month === 25) {
                    html += `
                        <tr class="year-row">
                            <td colspan="5">Year ${d.year}</td>
                        </tr>
                    `;
                }

                html += `
                    <tr>
                        <td>${d.label}</td>
                        <td>${formatNumber(d.artists)}</td>
                        <td>${formatNumber(d.listeners)}</td>
                        <td>${formatCurrency(d.monthlyRevenue)}</td>
                        <td>${formatCurrency(cumulative)}</td>
                    </tr>
                `;
            });

            document.getElementById('monthlyTableBody').innerHTML = html;
        }

        function syncYearStarts() {
            // Y2 start = Y1 end
            document.getElementById('y2StartArtists').value = 
                document.getElementById('y1EndArtists').value;
            document.getElementById('y2StartListeners').value = 
                document.getElementById('y1EndListeners').value;
            
            // Y3 start = Y2 end
            document.getElementById('y3StartArtists').value = 
                document.getElementById('y2EndArtists').value;
            document.getElementById('y3StartListeners').value = 
                document.getElementById('y2EndListeners').value;
        }

        function openModal() {
            document.getElementById('modalOverlay').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('active');
        }

        function addStream() {
            const name = document.getElementById('newStreamName').value;
            const type = document.getElementById('newStreamType').value;
            const phase = document.getElementById('newStreamPhase').value;
            const price = parseFloat(document.getElementById('newStreamPrice').value) || 0;
            const adoption = parseFloat(document.getElementById('newStreamAdoption').value) || 0;
            const target = document.getElementById('newStreamTarget').value;

            if (!name) {
                alert('Please enter a stream name');
                return;
            }

            const newStream = {
                id: nextId++,
                name,
                phase,
                type,
                active: true,
                price,
                adoption,
                target,
                platformTake: 100,
                frequency: type === 'recurring' ? undefined : 12
            };

            revenueStreams.push(newStream);
            closeModal();
            renderStreams();
            renderChart();

            // Clear form
            document.getElementById('newStreamName').value = '';
            document.getElementById('newStreamPrice').value = '';
            document.getElementById('newStreamAdoption').value = '';
        }

        // Event Listeners
        document.querySelectorAll('.curve-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.curve-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                growthCurve = btn.dataset.curve;
                renderStreams();
                renderChart();
            });
        });

        document.querySelectorAll('.year-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.year-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                selectedYear = parseInt(tab.dataset.year);
                updateSummary();
            });
        });

        // Growth inputs
        document.querySelectorAll('.year-card input').forEach(input => {
            input.addEventListener('input', () => {
                syncYearStarts();
                renderStreams();
                renderChart();
            });
        });

        // Modal close on overlay click
        document.getElementById('modalOverlay').addEventListener('click', (e) => {
            if (e.target === document.getElementById('modalOverlay')) {
                closeModal();
            }
        });

        // Initialize
        syncYearStarts();
        renderStreams();
        renderChart();
    </script>
</body>
</html>
